@implements IDisposable
@inject IDialogService DialogService
@inject IDispatcher Dispatcher
@inject ISmartSimObserver SmartSimObserver

<MudGrid Justify="Justify.Center" Class="scan-issues-container">
    @foreach (var scanIssue in SmartSimObserver.ScanIssues)
    {
        <MudItem xs="12" md="6" lg="4" xl="3" xxl="2">
            <MudCard Outlined="true" Elevation="5" Style="@($"backdrop-filter: blur(10px); background-color: color-mix(in srgb, transparent, var(--mud-palette-{scanIssue.Type switch { ScanIssueType.Dead => "error", ScanIssueType.Sick => "error", ScanIssueType.Uncomfortable => "warning", _ => "surface" }}) {scanIssue.Type switch { ScanIssueType.Dead => "70%", _ => "40%" }}); height: 100%;")">
                <MudCardHeader>
                    <CardHeaderAvatar>
                        <MudAvatar Variant="Variant.Outlined">
                            <MudIcon Icon="@scanIssue.Icon" Size="Size.Large" />
                        </MudAvatar>
                    </CardHeaderAvatar>
                    <CardHeaderContent>
                        <MudTextM3 Typo="TypoM3.Title">@scanIssue.Caption</MudTextM3>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudMarkdown Value="@scanIssue.Description" />
                </MudCardContent>
                @if (scanIssue.Data is not null && scanIssue.Resolutions is not null && scanIssue.Resolutions.Count > 0)
                {
                    <MudCardActions Style="flex-direction: column;">
                        @foreach (var resolution in scanIssue.Resolutions)
                        {
                            if (resolution.Url is { } url)
                            {
                                <MudButton StartIcon="@resolution.Icon" IconColor="@resolution.Color" Color="@resolution.Color" Href="@url.ToString()" Target="_blank">@resolution.Label</MudButton>
                            }
                            else
                            {
                                <MudButton StartIcon="@resolution.Icon" IconColor="@resolution.Color" Color="@resolution.Color" OnClick="() => ResolveAsync(scanIssue, resolution)">@resolution.Label</MudButton>
                            }
                        }
                    </MudCardActions>
                }
            </MudCard>
        </MudItem>
    }
</MudGrid>