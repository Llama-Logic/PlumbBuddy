@inject IElectronicArtsApp ElectronicArtsApp
@inject IFolderPicker FolderPicker
@inject IStringLocalizer<AppText> Localizer
@inject ISteam Steam

<MudGrid Spacing="12" Justify="Justify.Center">
    <MudItem>
        <MudStack Row Spacing="6">
            <MudBadge Icon="@MaterialDesignIcons.Outline.CheckboxMarkedCircle" Color="Color.Success" Overlap="true">
                <img src="@(DeviceInfo.Current.Platform == DevicePlatform.macOS || DeviceInfo.Current.Platform == DevicePlatform.MacCatalyst ? "/img/macOSLogo.png" : "/img/WindowsLogo.svg")" width="56" height="56" />
            </MudBadge>
            <MudStack Justify="Justify.FlexStart" Spacing="0">
                <MudTextM3 Typo="TypoM3.Body" Size="Size.Small">
                    @Localizer["FoldersSelector_OperatingSystem"]
                </MudTextM3>
                @if (DeviceInfo.Current.Platform == DevicePlatform.macOS || DeviceInfo.Current.Platform == DevicePlatform.MacCatalyst)
                {
                    <MudTextM3 Typo="TypoM3.Body">
                        @Localizer["FolderSelector_MacOS"]
                    </MudTextM3>
                }
                @if (DeviceInfo.Current.Platform == DevicePlatform.WinUI)
                {
                    <MudTextM3 Typo="TypoM3.Body">
                        @Localizer["FoldersSelector_Windows"]
                    </MudTextM3>
                }
                <MudTextM3 Typo="TypoM3.Body" Size="Size.Small">
                    @CultureInfo.CurrentCulture.NativeName
                </MudTextM3>
                <MudButton StartIcon="@MaterialDesignIcons.Normal.FolderAccount" Variant="Variant.Filled" Class="mt-4" OnClick="UseDefaultUserDataAndDownloadsFoldersOnClickAsync">@Localizer["FoldersSelector_ResetPaths"]</MudButton>
            </MudStack>
        </MudStack>
    </MudItem>
    <MudItem>
        <MudStack Row Spacing="6">
            <MudBadge Icon="@(isEAAppInstalled ? isTS4AvailableFromEA ? MaterialDesignIcons.Outline.CheckboxMarkedCircleAuto : MaterialDesignIcons.Outline.CheckboxMarkedCircle : MaterialDesignIcons.Outline.CheckboxBlankCircle)" Color="@(isTS4AvailableFromEA ? Color.Success : Color.Dark)" Overlap="true">
                <img src="/img/EAAppLogo.png" width="56" height="56" />
            </MudBadge>
            <MudStack Justify="Justify.FlexStart" Spacing="0">
                <MudTextM3 Typo="TypoM3.Body" Size="Size.Small">
                    @Localizer["FoldersSelector_DistributionPlatform"]
                </MudTextM3>
                <MudTextM3 Typo="TypoM3.Body">
                    @Localizer["FoldersSelector_TheEAApp"]
                </MudTextM3>
                <MudTextM3 Typo="TypoM3.Body" Size="Size.Small">
                    @if (isTS4AvailableFromEA)
                    {
                        @Localizer["FoldersSelector_TS4_Installed"]
                    }
                    else
                    {
                        @Localizer["FoldersSelector_TS4_NotInstalled"]
                    }
                </MudTextM3>
                @if (isTS4AvailableFromEA)
                {
                    <MudLoadingButton @bind-Loading="@isFetchingInstallationFolder" StartIcon="@MaterialDesignIcons.Normal.FolderTable" LoadingAdornment="Adornment.Start" Variant="Variant.Filled" Class="mt-4" OnClick="UseEAAppVersionOnClickAsync">@Localizer["Common_Select"]</MudLoadingButton>
                }
            </MudStack>
        </MudStack>
    </MudItem>
    <MudItem>
        <MudStack Row Spacing="6">
            <MudBadge Icon="@(isSteamInstalled ? isTS4AvailableFromValve ? MaterialDesignIcons.Outline.CheckboxMarkedCircleAuto : MaterialDesignIcons.Outline.CheckboxMarkedCircle : MaterialDesignIcons.Outline.CheckboxBlankCircle)" Color="@(isTS4AvailableFromValve ? Color.Success : Color.Dark)" Overlap="true">
                <img src="/img/SteamLogo.svg" width="56" height="56" />
            </MudBadge>
            <MudStack Justify="Justify.FlexStart" Spacing="0">
                <MudTextM3 Typo="TypoM3.Body" Size="Size.Small">
                    @Localizer["FoldersSelector_DistributionPlatform"]
                </MudTextM3>
                <MudTextM3 Typo="TypoM3.Body">
                    @Localizer["FoldersSelector_ValveSteam"]
                </MudTextM3>
                <MudTextM3 Typo="TypoM3.Body" Size="Size.Small">
                    @if (isTS4AvailableFromValve)
                    {
                        @Localizer["FoldersSelector_TS4_Installed"]
                    }
                    else
                    {
                        @Localizer["FoldersSelector_TS4_NotInstalled"]
                    }
                </MudTextM3>
                @if (isTS4AvailableFromValve)
                {
                    <MudLoadingButton @bind-Loading="@isFetchingInstallationFolder" StartIcon="@MaterialDesignIcons.Normal.FolderTable" LoadingAdornment="Adornment.Start" Variant="Variant.Filled" Class="mt-4" OnClick="UseSteamVersionOnClickAsync">@Localizer["Common_Select"]</MudLoadingButton>
                }
            </MudStack>
        </MudStack>
    </MudItem>
</MudGrid>
@if (IsOnboarding)
{
    <MudTextM3 Typo="TypoM3.Title" Align="Align.Center" Class="mt-8">
        @Localizer["FoldersSelector_ManualSelection_OnboardingHeading_1"]
    </MudTextM3>
    <MudTextM3 Typo="TypoM3.Headline" Align="Align.Center">
        @Localizer["FoldersSelector_ManualSelection_OnboardingHeading_2"]
    </MudTextM3>
}
<MudGrid Justify="Justify.Center" Class="mt-8 mb-4">
    <MudItem xs="10">
        <MudForm @ref="@foldersForm">
            <MudTextFieldExtended T="string" Label="@Localizer["FoldersSelector_UserDataFolder"]" Variant="Variant.Filled" @bind-Text="@UserDataFolderPath" Immediate Required Validation="@(new Func<string, string?>(ValidateUserDataFolderPath))">
                <AdornmentStart>
                    <MudIcon Icon="@MaterialDesignIcons.Normal.FolderAccount" />
                </AdornmentStart>
                <AdornmentEnd>
                    <MudButton Variant="Variant.Filled" StartIcon="@MaterialDesignIcons.Normal.FolderOpen" OnClick="BrowseForUserDataFolderOnClickAsync">@Localizer["Common_Browse_Ellipsis"]</MudButton>
                </AdornmentEnd>
            </MudTextFieldExtended>
            <br />
            <MudTextFieldExtended T="string" Label="@Localizer["FoldersSelector_InstallationFolder"]" Variant="Variant.Filled" @bind-Text="@InstallationFolderPath" Immediate Required Validation="@(new Func<string, string?>(ValidateInstallationFolderPath))">
                <AdornmentStart>
                    <MudIcon Icon="@MaterialDesignIcons.Normal.FolderTable" />
                </AdornmentStart>
                <AdornmentEnd>
                    <MudButton Variant="Variant.Filled" StartIcon="@MaterialDesignIcons.Normal.FolderOpen" OnClick="BrowseForInstallationFolderOnClickAsync">@Localizer["Common_Browse_Ellipsis"]</MudButton>
                </AdornmentEnd>
            </MudTextFieldExtended>
            <br />
            <MudTextFieldExtended T="string" Label="@Localizer["FoldersSelector_DownloadsFolder"]" Variant="Variant.Filled" @bind-Text="@DownloadsFolderPath" Immediate Required Validation="@(new Func<string, string?>(ValidateDownloadsFolderPath))">
                <AdornmentStart>
                    <MudIcon Icon="@MaterialDesignIcons.Normal.FolderDownload" />
                </AdornmentStart>
                <AdornmentEnd>
                    <MudButton Variant="Variant.Filled" StartIcon="@MaterialDesignIcons.Normal.FolderOpen" OnClick="BrowseForDownloadsFolderOnClickAsync">@Localizer["Common_Browse_Ellipsis"]</MudButton>
                </AdornmentEnd>
            </MudTextFieldExtended>
        </MudForm>
    </MudItem>
</MudGrid>
<br />
