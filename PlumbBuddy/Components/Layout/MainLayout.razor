@inherits ReactiveLayoutComponentBase
@inject IBlazorFramework BlazorFramework
@inject ICustomThemes CustomThemes
@inject IDialogService DialogService
@inject IDispatcher Dispatcher
@inject IJSRuntime JSRuntime
@inject ILifetimeScope LifetimeScope
@inject ILogger<MainLayout> Logger
@inject ISettings Settings
@inject ISnackbar Snackbar
@inject ISuperSnacks SuperSnacks

<MudThemeProvider DefaultScrollbar="true" IsDarkMode="@isDarkMode" Theme="@Theme" />
@if (Observed(() => Settings.ShowThemeManager))
{
    <MudThemeManagerButton OnClick="@((e) => OpenThemeManager(true))" />
    <MudThemeManager Open="@themeManagerOpen" IsDarkMode="@isDarkMode" OpenChanged="OpenThemeManager" Theme="@themeManagerTheme" ThemeChanged="UpdateTheme" />
}
<MudPopoverProvider />
<MudDialogProvider />
<MudScrollbar Color="info" HoverColor="primary" TrackColor="#27272f30" Width="12" />
<MudSnackbarProvider />
<MudTypographyProvider />

<MudDrawer @bind-Open="@isMainMenuDrawerOpen" Anchor="Anchor.Left" Elevation="1" Variant="@DrawerVariant.Temporary" OverlayAutoClose="true">
    <MainMenu CloseDrawer="CloseDrawerHandler" />
</MudDrawer>

<MudAnimate Selector=".plumbbuddy-is-thinking" AnimationType="AnimationType.Fade" Value="1" ValueSecondary="0.5" Duration="0.5" Infinite="true" AnimationTiming="AnimationTiming.EaseOut" AnimationDirection="AnimationDirection.AlternateReverse" AnimationFillMode="AnimationFillMode.Forwards" />
<MudAnimate Selector=".plumbbuddy-is-thinking-2" AnimationType="AnimationType.Fade" Value="0.5" ValueSecondary="1" Duration="0.5" Infinite="true" AnimationTiming="AnimationTiming.EaseIn" AnimationDirection="AnimationDirection.AlternateReverse" AnimationFillMode="AnimationFillMode.Forwards" />

<MudLayout>
    <MudAppBar>
        <MudToggleIconButton @bind-Toggled="@isMainMenuDrawerOpen" Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" />
		<MudImage Src="@(Observed(() => Settings.Theme) is { } customThemeName && CustomThemes.Themes.TryGetValue(customThemeName, out var customTheme) && customTheme.CustomAppLogo ? $"/img/custom-themes/{customThemeName}/applogo.svg" : "/img/PlumbBuddyLogo.svg")" Width="48" Height="48" ObjectFit="ObjectFit.Fill" ObjectPosition="ObjectPosition.Center" />
        @if (Observed(() => Settings.ShowThemeManager))
        {
            if (@manualLightDarkModeToggleEnabled)
            {
                <MudTooltip Arrow="true" Text="@(AppText.MainLayout_DevTools_ThemeManager_ToggleMode_Tip)">
                    <MudSwitchM3 T="bool" @bind-Value="@ManualLightDarkModeToggle" ThumbOffIcon="@MaterialDesignIcons.Normal.LightbulbOn" ThumbIcon="@MaterialDesignIcons.Normal.LightbulbNight" Color="Color.Primary" Style="margin-left: 15px;" />
                </MudTooltip>
            }
            <MudTooltip Arrow="true" Text="@(AppText.MainLayout_DevTools_ThemeManager_ToggleModeControl_Tip)">
                <MudSwitchM3 T="bool" @bind-Value="@ManualLightDarkModeToggleEnabled" ThumbOffIcon="@MaterialDesignIcons.Normal.RefreshAuto" ThumbIcon="@MaterialDesignIcons.Normal.CarShiftPattern" Color="Color.Primary" Style="margin-left: 15px;" />
            </MudTooltip>
        }
        <MudPaper Elevation="0" Outlined Class="rounded-pill mx-4" Style="padding: 0 5px;">
			<MainToolbar />
            <HUD />
        </MudPaper>
    </MudAppBar>
    <MudMainContent>
        @Body
    </MudMainContent>
</MudLayout>
