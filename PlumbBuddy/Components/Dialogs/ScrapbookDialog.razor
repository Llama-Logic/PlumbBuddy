@inherits ReactiveComponentBase
@inject IMarkupLocalizer<AppText> MarkupLocalizer

@if (Chronicle is { } chronicle)
{
    <MudDialog Class="secondary-dialog">
        <TitleContent>
            <MudStack Row AlignItems="AlignItems.Center">
                <MudIcon Icon="@MaterialDesignIcons.Normal.ImageAlbum" Color="Color.Secondary" />
                <MudTextM3 Typo="TypoM3.Title" Color="Color.Secondary">@(chronicle.Name) Scrapbook@(Observed(() => chronicle.IsLoadingScrapbookImages) ? " (Loading)" : "")</MudTextM3>
            </MudStack>
        </TitleContent>
        <DialogContent>
            <MudGrid>
                @foreach (var scrapbookImage in ObservedCollection(() => chronicle.ScrapbookImages))
                {
                    <MudItem xs="3">
                        <MudStack Justify="Justify.Center" AlignItems="AlignItems.Center">
                            <div style="aspect-ratio: 1/1;">
                                <MudImage Src="@($"data:{(scrapbookImage.ImageType is ResourceFileType.JointPhotographicExpertsGroupImage ? "image/jpeg" : "image/png")};base64,{Convert.ToBase64String(scrapbookImage.ImageData.ToArray())}")" ObjectFit="ObjectFit.Contain" ObjectPosition="ObjectPosition.Center" Style="width: 100%; height: 100%; max-width: 300px; max-height: 300px;" />
                            </div>
                            <MudChip Color="Color.Secondary" Icon="@(scrapbookImage.Key.Type switch { ResourceType.MemorialThumbnail => MaterialDesignIcons.Normal.GraveStone, ResourceType.SaveGameSimCustomTexture => MaterialDesignIcons.Normal.Brush, _ => MaterialDesignIcons.Normal.Image })" Value="@(scrapbookImage.Description)" />
                        </MudStack>
                    </MudItem>
                    @foreach (var revision in ObservedCollection(() => scrapbookImage.Revisions))
                    {
                        <MudItem xs="3">
                            <MudStack AlignItems="AlignItems.Center">
                                <div style="aspect-ratio: 1/1;">
                                    <MudImage Src="@($"data:{(scrapbookImage.ImageType is ResourceFileType.JointPhotographicExpertsGroupImage ? "image/jpeg" : "image/png")};base64,{Convert.ToBase64String(revision.ImageData.ToArray())}")" ObjectFit="ObjectFit.Contain" ObjectPosition="ObjectPosition.Center" Style="width: 100%; height: 100%; max-width: 300px; max-height: 300px;" />
                                </div>
                                <MudChip Color="Color.Secondary" Icon="@(scrapbookImage.Key.Type switch { ResourceType.MemorialThumbnail => MaterialDesignIcons.Normal.GraveStone, ResourceType.SaveGameSimCustomTexture => MaterialDesignIcons.Normal.Brush, _ => MaterialDesignIcons.Normal.Image })" Value="@(revision.Description)" />
                            </MudStack>
                        </MudItem>
                    }
                }
            </MudGrid>
        </DialogContent>
        <DialogActions>
            @if (Observed(() => chronicle.IsLoadingScrapbookImages))
            {
                <MudProgressLinear Color="Color.Secondary" Indeterminate />
            }
            <MudButton OnClick="OkOnClickHandler">
                @MarkupLocalizer[nameof(AppText.Common_Ok)]
            </MudButton>
        </DialogActions>
    </MudDialog>
}
